Анализ угроз информационной безопасности для облачных систем автоматизации ресторанов. Система iiko
Обзор проекта
Данный проект разработан в рамках дипломной работы, посвященной анализу угроз информационной безопасности для облачных систем автоматизации ресторанов, в частности системы iiko. Практическая часть проекта заключается в создании системы управления безопасным доступом к API, интегрированной с Telegram-ботом для мониторинга и уведомления о событиях безопасности в реальном времени. Система предназначена для защиты API-взаимодействий, логирования попыток доступа и уведомления администраторов о несанкционированных действиях или потенциальных атаках.
Проект состоит из трех основных компонентов:

Веб-сервер на базе Flask (app.py): обрабатывает API-запросы, логирует события безопасности и отправляет уведомления.
Telegram-бот (bot_handler.py): предоставляет интерфейс для администраторов, позволяющий отслеживать статус системы и просматривать логи.
Модуль конфигурации (config.py): управляет переменными окружения и настройками системы.

Этот репозиторий представляет собой прототип решения для обеспечения безопасности API-доступа в облачных системах, таких как iiko, с акцентом на мониторинг, логирование и оперативное оповещение.

Контекст дипломной работы
Проект соответствует следующей структуре диплома:

Введение

Актуальность: Облачные системы автоматизации ресторанов, такие как iiko, становятся мишенью атак из-за активного использования API для обмена данными. Обеспечение безопасности API-доступа критически важно для предотвращения утечек данных и обеспечения бесперебойной работы.
Цель: Разработать систему управления безопасным доступом к API и мониторинга инцидентов безопасности для облачной инфраструктуры iiko.
Задачи: Провести анализ угроз, спроектировать систему безопасного доступа к API, реализовать Telegram-бот для уведомлений, протестировать решение.
Объект и предмет исследования: Объект — облачная система iiko; предмет — безопасность её API-взаимодействий.


Анализ угроз для облачных систем автоматизации ресторанов

Типы угроз: Несанкционированный доступ, перехват данных, злоупотребление API, атаки типа «отказ в обслуживании» (DoS).
Уязвимости API iiko: Слабая аутентификация, отсутствие ограничения частоты запросов, недостаточное логирование.
Методы атак: Подбор учетных данных, SQL-инъекции, эксплуатация ключей API.


Разработка системы управления безопасным API-доступом

Требования: Надежная аутентификация, полное логирование, уведомления в реальном времени, доступ только для администраторов.
Архитектура: Веб-сервер на Flask с интеграцией Telegram-бота.
Механизмы аутентификации и авторизации: Ролевой контроль доступа (в текущей версии is_authorized возвращает False).
Интеграция с Telegram-ботом: Бот для проверки статуса, просмотра логов и получения уведомлений об инцидентах.


Реализация и тестирование

Развертывание: Локальное или облачное (например, PythonAnywhere).
Разработка бота: Асинхронный бот на базе aiogram для обработки команд.
Проверка безопасности: Тестирование обнаружения несанкционированного доступа и надежности уведомлений.


Заключение

Выводы: Система эффективно логирует попытки доступа к API и уведомляет администраторов об угрозах.
Перспективы: Реализация полноценной аутентификации, ротация логов, внедрение продвинутого обнаружения угроз.



Данный проект фокусируется на практической реализации, описанной в разделе 3, с Telegram-ботом и Flask-сервером в качестве основных компонентов.

Использованные технологии и инструменты
Проект был разработан с использованием следующих технологий и библиотек:

Python 3.8+: Основной язык программирования.
Flask: Легковесный веб-фреймворк для создания API и веб-интерфейса.
aiogram: Асинхронная библиотека для разработки Telegram-бота.
python-dotenv: Для загрузки переменных окружения из файла .env.
requests: Для отправки HTTP-запросов к Telegram API.
logging: Для записи логов в файл и вывода в консоль.
Jinja2: Для рендеринга HTML-шаблонов (например, logs.html).
HTTPS (adhoc): Для локального тестирования с поддержкой SSL.
PythonAnywhere (опционально): Платформа для развертывания.
Git: Для контроля версий.

Как писался проект

Планирование:
Определены ключевые требования: логирование всех API-запросов, уведомления о несанкционированном доступе, ограничение доступа для неадминистраторов.
Разработана архитектура: Flask-сервер для обработки запросов, Telegram-бот для взаимодействия с администраторами, общий модуль конфигурации.


Разработка:
Конфигурация (config.py): Создан класс Config для управления настройками, включая токен бота, список администраторов и пути к файлам логов. Реализована проверка наличия токена и создание директории для логов.
Telegram-бот (bot_handler.py): Использована библиотека aiogram для создания асинхронного бота. Реализованы команды /start, /help, /status, /logs с проверкой прав доступа через ADMIN_IDS.
Flask-приложение (app.py): Разработаны маршруты /api/health, /api/access и /logs. Реализовано логирование в файл, отправка уведомлений в Telegram и рендеринг логов в веб-интерфейсе.


Интеграция:
Telegram-бот интегрирован с веб-сервером через кнопку /logs, ведущую на страницу просмотра логов.
Реализована отправка уведомлений о несанкционированных попытках доступа через Telegram API.


Тестирование:
Проверена работа бота: обработка команд, доступ только для администраторов.
Протестирован сервер: обработка API-запросов, логирование, отображение логов.
Проверена отправка уведомлений при попытках несанкционированного доступа.



Проект писался с учетом модульности и возможности масштабирования, но в текущей версии содержит упрощенную реализацию аутентификации (is_authorized всегда возвращает False).

Как работает проект
1. Конфигурация (config.py)

Функция: Хранит настройки, такие как токен Telegram-бота, список администраторов, URL API и путь к файлу логов.
Процесс:
Загружает переменные окружения из файла .env (например, BOT_TOKEN).
Определяет константы: ADMIN_IDS (список ID администраторов), API_BASE_URL (локальный или облачный URL), LOG_FILE (путь к файлу логов).
Создает директорию logs, если она отсутствует.
Проверяет наличие токена бота, выбрасывая ошибку при его отсутствии.



2. Telegram-бот (bot_handler.py)

Функция: Обеспечивает интерфейс для администраторов через Telegram.
Команды:
/start: Отправляет приветственное сообщение.
/help: Показывает список доступных команд (только для администраторов).
/status: Сообщает о статусе системы (только для администраторов).
/logs: Отправляет кнопку для открытия веб-интерфейса с логами (только для администраторов).


Доступ: Проверяет, входит ли ID пользователя в ADMIN_IDS. Если нет, отвечает сообщением об отсутствии доступа.
Работа: Использует асинхронный фреймворк aiogram для обработки команд и запускается через dp.start_polling.

3. Flask-приложение (app.py)

Функция: Обрабатывает HTTP-запросы, логирует события и отправляет уведомления.
Маршруты:
/api/health (GET): Возвращает статус системы ({"status": "ok"}).
/api/access (POST): Обрабатывает попытки доступа. Если запрос не авторизован (функция is_authorized возвращает False), логирует событие, отправляет уведомление в Telegram и возвращает ошибку 401.
/logs (GET): Отображает последние 100 строк логов в веб-интерфейсе через шаблон logs.html.


Логирование:
Логи сохраняются в файл logs/security.log в формате: время - имя логгера - уровень - сообщение.
Если файл логов отсутствует, он создается с начальной записью.
При ошибках чтения или парсинга логов записывается сообщение об ошибке.


Уведомления:
Функция send_telegram_message отправляет сообщения администраторам через Telegram API.
При попытке несанкционированного доступа формируется сообщение с IP-адресом и данными запроса.


Запуск: Сервер работает на 0.0.0.0:5000 с поддержкой HTTPS (локально через ssl_context='adhoc').

4. Общий процесс работы

Инициализация:
Загружаются настройки из config.py.
Создается директория для логов.
Настраивается логирование в файл и консоль.


Запуск:
Telegram-бот ожидает команды от пользователей.
Flask-сервер обрабатывает API-запросы и отображает логи.


Мониторинг:
При запросе к /api/access проверяется авторизация. Если она не пройдена, отправляется уведомление администраторам.
Все события (запуск, ошибки, попытки доступа) логируются.


Администрирование:
Администраторы используют Telegram-бот для проверки статуса или просмотра логов через веб-интерфейс.



Пример сценария

Пользователь отправляет /start в Telegram → Бот отвечает приветствием.
Администратор отправляет /logs → Бот отправляет кнопку, ведущую на страницу /logs сервера → В браузере отображаются последние 100 строк логов.
Неавторизованный запрос отправляется на /api/access → Сервер логирует попытку, отправляет уведомление в Telegram и возвращает ошибку 401.
Администратор отправляет /status → Бот подтверждает, что система работает.


Установка и запуск
Требования

Python 3.8+
Установленные зависимости (см. ниже)
Файл .env с переменной BOT_TOKEN (токен Telegram-бота)

Установка

Клонируйте репозиторий:git clone <ссылка_на_репозиторий>
cd <название_папки>


Создайте виртуальное окружение:python -m venv venv
source venv/bin/activate  # Для Windows: venv\Scripts\activate


Установите зависимости:pip install flask aiogram python-dotenv requests


Создайте файл .env в корне проекта:BOT_TOKEN=ваш_токен_бота
SECRET_KEY=ваш_секретный_ключ


(Опционально) Для развертывания на PythonAnywhere задайте переменную окружения PYTHONANYWHERE_SITE.

Запуск

Запустите Flask-сервер:python app.py


В отдельном терминале запустите Telegram-бот:python bot_handler.py


Для локального тестирования откройте браузер по адресу https://localhost:5000/logs или взаимодействуйте с ботом в Telegram.


Особенности и ограничения

Особенности:
Ограничение доступа к командам и логам только для администраторов (ADMIN_IDS).
Полное логирование событий в файл с возможностью просмотра через веб-интерфейс.
Уведомления о несанкционированных попытках доступа через Telegram.
Модульная структура для упрощения доработки.


Ограничения:
Функция is_authorized не реализована (всегда возвращает False).
Ограничение на 100 строк при просмотре логов.
Отсутствует ротация логов, что может привести к росту размера файла.
Нет обработки ошибок при недоступности Telegram API.




Перспективы развития

Реализовать полноценную аутентификацию в is_authorized (например, проверка токенов или ключей API).
Добавить ротацию логов для управления их размером.
Внедрить фильтрацию и поиск по логам в веб-интерфейсе.
Расширить функционал бота: команды для управления настройками или фильтрации логов.
Добавить мониторинг частоты запросов для обнаружения DoS-атак.
Интегрировать анализ угроз в реальном времени с использованием ML-моделей.

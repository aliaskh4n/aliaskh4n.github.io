# Система электронного голосования на блокчейне

## Описание

Эта система разработана для организации безопасного и прозрачного электронного голосования с использованием технологии блокчейн. Система позволяет проводить выборы, регистрировать избирателей, обеспечивать безопасное голосование и подсчет голосов.

## Функциональные возможности

- **Регистрация и идентификация избирателей** - безопасная регистрация с использованием ПИН.
- **Шифрование голосов** - использование криптографии для защиты тайны голосования.
- **Сохранение голосов в блокчейне** - неизменяемая запись всех голосов.
- **Автоматический подсчет голосов** - прозрачный процесс подсчета.
- **Многоязычный интерфейс** - поддержка русского, казахского и английского языков.
- **Административная панель** - для управления выборами и кандидатами.
- **Доступность** - адаптивный дизайн для всех типов устройств.

## Технический стек

- **Backend**: Python, Flask
- **Database**: SQLite
- **Cryptography**: RSA для шифрования голосов
- **Blockchain**: Собственная реализация на Python
- **Frontend**: HTML5, CSS3, JavaScript, Bootstrap 5
- **Локализация**: Flask-Babel

## Требования

- Python 3.8+
- pip (менеджер пакетов Python)
- Виртуальное окружение Python (рекомендуется)

## Установка и запуск

### 1. Клонирование репозитория

```bash
git clone https://github.com/yourusername/blockchain-voting-system.git
cd blockchain-voting-system
```

### 2. Создание виртуального окружения

```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
venv\Scripts\activate     # для Windows
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

Или установите зависимости вручную:

```bash
pip install Flask==3.0.3 Flask-Babel==4.0.0 Werkzeug==2.0.1 cryptography==36.0.1 Babel==2.9.1 pytz==2021.3 python-dotenv==0.19.2
```

### 4. Структура проекта

Убедитесь, что у вас есть следующая структура файлов:

```
blockchain_voting/
├── app.py                # Основной файл приложения
├── admin.py              # Административная панель
├── main.py               # Инициализация и запуск приложения
├── static/               # Статические файлы
│   ├── css/
│   │   └── style.css     # CSS стили
│   └── js/
│       └── script.js     # JavaScript
├── templates/            # HTML шаблоны
│   ├── base.html         # Базовый шаблон
│   ├── index.html        # Главная страница
│   ├── register.html     # Страница регистрации
│   └── admin/            # Шаблоны административной панели
└── translations/         # Файлы переводов
```

### 5. Настройка часового пояса

Убедитесь, что ваш сервер настроен на правильный часовой пояс:

```bash
# Проверка текущего часового пояса
date

# Установка часового пояса для Казахстана
sudo timedatectl set-timezone Asia/Almaty

# Проверка после изменения
date
```

### 6. Инициализация базы данных

База данных SQLite будет автоматически создана при первом запуске приложения. Если вы хотите пересоздать базу данных, просто удалите файл `blockchain_voting.db` и перезапустите приложение.

### 7. Запуск приложения

```bash
cd blockchain_voting
python main.py
```

По умолчанию приложение будет доступно по адресу http://127.0.0.1:5000

### 8. Дополнительные настройки

Вы можете настроить параметры запуска в файле `.env`:

```
SECRET_KEY=your_very_secure_secret_key
PORT=5000
DEBUG=True
```

## Использование системы

### Для избирателей

1. **Регистрация**:
   - Перейдите на http://ваш_сайт/register
   - Введите ваш ПИН и пароль
   - Система сгенерирует ключи шифрования для вашего голоса

2. **Вход в систему**:
   - Перейдите на http://ваш_сайт/login
   - Введите ваш ПИН и пароль

3. **Голосование**:
   - После входа в систему вам будет показан список кандидатов
   - Выберите кандидата и нажмите кнопку "Проголосовать"
   - После голосования вы получите подтверждение о том, что ваш голос записан в блокчейн

4. **Просмотр результатов**:
   - После окончания выборов перейдите на http://ваш_сайт/results
   - Вы увидите результаты голосования

### Для администраторов

1. **Вход в административную панель**:
   - Перейдите на http://ваш_сайт/admin/login
   - Введите имя пользователя и пароль по умолчанию:
     - Имя пользователя: `admin`
     - Пароль: `admin123`
   - **Важно**: Смените пароль администратора после первого входа!

2. **Управление выборами**:
   - Перейдите на http://ваш_сайт/admin/elections
   - Здесь вы можете создавать, редактировать и удалять выборы
   - При создании выборов укажите:
     - Название
     - Описание
     - Дату и время начала
     - Дату и время окончания
     - Статус (активно/неактивно)

3. **Управление кандидатами**:
   - Перейдите на http://ваш_сайт/admin/candidates
   - Здесь вы можете добавлять, редактировать и удалять кандидатов
   - Для каждого кандидата вы можете указать:
     - Имя
     - Партию/Движение
     - URL фотографии

4. **Управление пользователями**:
   - Перейдите на http://ваш_сайт/admin/users
   - Здесь вы можете видеть всех зарегистрированных пользователей и их статус голосования
   - В экстренных случаях вы можете сбросить статус голосования пользователя

5. **Просмотр блокчейна**:
   - Перейдите на http://ваш_сайт/admin/blockchain
   - Здесь вы можете увидеть все блоки в цепи и голоса в каждом блоке

## Устранение неполадок

### Проблема: Сообщение "Выборы еще не начались"

**Решение**:
1. Проверьте, что часовой пояс на сервере установлен правильно:
   ```bash
   date
   ```

2. Если часовой пояс неправильный, установите правильный:
   ```bash
   sudo timedatectl set-timezone Asia/Almaty
   ```

3. Или измените время начала выборов через административную панель:
   - Войдите в административную панель
   - Перейдите в раздел "Управление выборами"
   - Отредактируйте активные выборы и измените время начала

### Проблема: Ошибка "No filter named 'datetime'"

**Решение**:
Добавьте следующий код в файл `main.py`:

```python
@app.template_filter('datetime')
def datetime_filter(timestamp):
    """Фильтр для форматирования timestamp в читаемый формат даты и времени"""
    import datetime
    return datetime.datetime.fromtimestamp(timestamp).strftime('%d %b. %Y г., %H:%M:%S')

@app.template_filter('timestamp_to_datetime')
def timestamp_to_datetime_filter(timestamp):
    """Фильтр для преобразования timestamp в формат datetime-local для input"""
    import datetime
    dt = datetime.datetime.fromtimestamp(timestamp)
    return dt.strftime('%Y-%m-%dT%H:%M')
```

### Проблема: Ошибка с Flask-Babel

**Решение**:
Если вы получаете ошибку связанную с `localeselector` или `locale_selector_func`, измените код инициализации Babel:

```python
def get_locale():
    if 'language' in session:
        return session['language']
    return request.accept_languages.best_match(['ru', 'kk', 'en'])

babel = Babel(app, locale_selector=get_locale)
app.config['BABEL_DEFAULT_LOCALE'] = 'ru'
app.config['BABEL_SUPPORTED_LOCALES'] = ['ru', 'kk', 'en']
```

### Проблема: Ошибка импорта из app.py в admin.py

**Решение**:
Если вы получаете циклические импорты, измените код в файле `admin.py`:

```python
@admin_bp.route('/blockchain')
@admin_required
def blockchain():
    # Импортируем здесь, чтобы избежать циклических импортов
    from app import blockchain as bc
    
    chain = bc.chain
    current_votes = bc.current_votes
    
    return render_template('admin/blockchain.html', chain=chain, current_votes=current_votes)
```

## Компиляция файлов переводов

Если вы хотите обновить или добавить новые переводы:

1. Извлечение строк для перевода:
```bash
pybabel extract -F babel.cfg -o messages.pot .
```

2. Создание или обновление файлов переводов:
```bash
pybabel update -i messages.pot -d translations -l ru  # Для русского языка
pybabel update -i messages.pot -d translations -l kk  # Для казахского языка
pybabel update -i messages.pot -d translations -l en  # Для английского языка
```

3. Компиляция файлов переводов:
```bash
pybabel compile -d translations
```

## Безопасность системы

- **Шифрование голосов**: Каждый голос шифруется с использованием RSA.
- **Блокчейн**: Обеспечивает неизменяемость записей голосования.
- **Хеширование**: Идентификаторы избирателей хешируются для обеспечения анонимности.
- **Проверка целостности**: Блокчейн использует механизм Proof of Work для защиты от подделки.

## Развертывание в продакшене

Для продакшен-окружения рекомендуется:

1. Использовать WSGI-сервер (Gunicorn, uWSGI):
```bash
pip install gunicorn
gunicorn --bind 0.0.0.0:5000 main:app
```

2. Настроить Nginx в качестве прокси-сервера:
```
server {
    listen 80;
    server_name ваш_домен;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

3. Настроить HTTPS с помощью Let's Encrypt:
```bash
sudo apt-get install certbot python3-certbot-nginx
sudo certbot --nginx -d ваш_домен
```

4. Использовать Supervisor для автоматического перезапуска приложения:
```
[program:blockchain_voting]
command=/путь/к/venv/bin/gunicorn -w 4 -b 127.0.0.1:5000 main:app
directory=/путь/к/проекту
user=ваш_пользователь
autostart=true
autorestart=true
redirect_stderr=true
```

## Лицензия

Этот проект распространяется под лицензией MIT. 

## Дополнительная информация

Для получения дополнительной помощи или сообщения об ошибках, пожалуйста, создайте issue в репозитории проекта.

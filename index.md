# Блокчейн-приложение для голосований: Техническая документация

## Введение

Данное приложение представляет собой веб-систему для проведения голосований с использованием технологии блокчейн. Приложение обеспечивает создание, управление и просмотр результатов голосований с сохранением всех данных в блокчейне, что обеспечивает прозрачность, неизменяемость и верифицируемость результатов.

## Архитектура приложения

Приложение построено по принципу клиент-серверной архитектуры с использованием блокчейна для хранения данных:

1. **Серверная часть**: Python-приложение с использованием Flask
2. **Клиентская часть**: HTML, CSS, JavaScript
3. **Блокчейн**: Собственная реализация на Python
4. **Коммуникация**: HTTP REST API и WebSocket для обновлений в реальном времени

## Используемые технологии

### Бэкенд

#### Python
- **Версия**: Определена неявно (рекомендуется Python 3.6+)
- **Назначение**: Основной язык серверной части приложения

#### Flask
- **Назначение**: Веб-фреймворк для создания API и рендеринга HTML шаблонов
- **Компоненты**:
  - `Flask`: Основной класс для создания веб-приложения
  - `request`: Обработка HTTP запросов
  - `jsonify`: Форматирование данных в JSON
  - `render_template`: Рендеринг HTML шаблонов

#### Flask-SocketIO
- **Назначение**: Реализация WebSockets для обновлений данных в реальном времени
- **Компоненты**:
  - `SocketIO`: Основной класс для работы с WebSockets
  - `emit`: Отправка сообщений по WebSocket

#### Криптографические библиотеки
- **hashlib**: Для хеширования блоков с помощью SHA-256
- **rsa**: Для генерации ключей, подписывания и верификации блоков
- **uuid**: Генерация уникальных идентификаторов пользователей
- **json**: Сериализация и десериализация данных

### Фронтенд

#### HTML/CSS
- **Версия HTML**: HTML5
- **Фреймворки и библиотеки CSS**:
  - Bootstrap 5.3.0: Для стилизации компонентов
  - Font Awesome 6.0.0: Для иконок

#### JavaScript
- **Особенности**:
  - Работа с DOM
  - AJAX запросы через Fetch API
  - WebSocket для обновлений в реальном времени
  - Локальное хранилище (localStorage) для сохранения предпочтений пользователя

#### WebSocket
- **Библиотека**: Socket.IO 4.5.4
- **Назначение**: Обновление визуализации блокчейна в реальном времени

### Блокчейн

Реализация собственного блокчейна со следующими особенностями:

#### Структура блока
- **index**: Порядковый номер блока
- **timestamp**: Время создания блока
- **data**: Данные блока (информация о голосовании или голосе)
- **previous_hash**: Хеш предыдущего блока
- **hash**: Хеш текущего блока
- **signature**: Цифровая подпись блока

#### Безопасность
- **Хеширование**: Алгоритм SHA-256
- **Цифровые подписи**: RSA шифрование (512 бит)
- **Доверенные узлы**: Только авторизованные узлы могут добавлять блоки
- **Валидация цепи**: Проверка целостности всей цепи блоков

#### Типы данных в блокчейне
1. **Genesis Block**: Первый блок в цепи
2. **Election Block**: Блок с информацией о голосовании
   - Название голосования
   - Список кандидатов и их данные
3. **Vote Block**: Блок с информацией о голосе
   - ID голосования
   - ID пользователя
   - Выбранный кандидат

## API Endpoints

### REST API

| Endpoint | Метод | Описание | Параметры |
|---------|------|-----------|-----------|
| `/get_chain` | GET | Получение всей цепочки блоков | - |
| `/elections` | GET | Получение списка всех голосований | - |
| `/create_election` | POST | Создание нового голосования | `title`, `candidates` |
| `/vote` | POST | Голосование за кандидата | `election_id`, `candidate`, `user_id` |
| `/api/election/<election_id>` | GET | Получение данных конкретного голосования | `election_id` (в URL) |

### WebSocket События

| Событие | Направление | Описание | Данные |
|---------|------------|-----------|--------|
| `get_chain` | Клиент → Сервер | Запрос на получение цепочки блоков | - |
| `chain_data` | Сервер → Клиент | Отправка цепочки блоков | `chain`, `valid` |

## Фронтенд страницы

### Главная страница (`index.html`)
- Навигация по приложению
- Переключение между светлой и темной темой
- Встроенная визуализация блокчейна

### Страница создания голосования (`create_election.html`)
- Форма для создания нового голосования
- Добавление и удаление кандидатов (до 10)
- Визуализация блокчейна

### Страница списка голосований (`elections.html`)
- Отображение всех существующих голосований
- Переход к конкретному голосованию
- Визуализация блокчейна

### Страница голосования (`election.html`)
- Информация о голосовании
- Список кандидатов с возможностью голосования
- Отображение результатов в реальном времени
- Визуализация блокчейна

### Страница просмотра блокчейна (`block.html`)
- Детальная визуализация всех блоков
- Отображение содержимого блоков
- Возможность копирования информации
- Автоматическое обновление через WebSocket

## Функции безопасности

1. **Неизменяемость данных**: Каждый блок связан с предыдущим через хеш
2. **Цифровые подписи**: Все блоки подписываются, что гарантирует их подлинность
3. **Валидация цепи**: Регулярная проверка целостности всего блокчейна
4. **Доверенные узлы**: Только авторизованные узлы могут добавлять блоки
5. **Уникальные ID пользователей**: Для идентификации избирателей

## Взаимодействие пользователя с системой

1. **Создание голосования**:
   - Администратор вводит название голосования
   - Добавляет кандидатов с информацией о них
   - Отправляет данные на сервер
   - Сервер создает новый блок типа "election"

2. **Голосование**:
   - Пользователь просматривает доступные голосования
   - Выбирает конкретное голосование
   - Голосует за кандидата
   - Система создает блок типа "vote" с информацией о голосе

3. **Просмотр результатов**:
   - Пользователь получает данные о голосовании и результатах
   - Система подсчитывает голоса для каждого кандидата
   - Результаты отображаются в реальном времени

## Особенности реализации блокчейна

### Структура цепи
Блокчейн представлен в виде массива блоков, где каждый блок содержит ссылку на предыдущий через его хеш.

### Создание блока
```python
def create_block(self, data, previous_hash, signer):
    if signer not in self.authorized_nodes:
        return None
    
    block = {
        'index': len(self.chain) + 1,
        'timestamp': time.time(),
        'data': data,
        'previous_hash': previous_hash,
    }
    block['hash'] = self.hash_block(block)
    signature = rsa.sign(block['hash'].encode(), admin_priv, 'SHA-256')
    block['signature'] = signature.hex()
    self.chain.append(block)
    return block
```

### Хеширование блока
```python
def hash_block(self, block):
    block_string = json.dumps({k: v for k, v in block.items() if k not in ['hash', 'signature']}, sort_keys=True).encode()
    return hashlib.sha256(block_string).hexdigest()
```

### Проверка действительности цепи
```python
def is_chain_valid(self):
    for i in range(1, len(self.chain)):
        current_block = self.chain[i]
        previous_block = self.chain[i - 1]
        if current_block['previous_hash'] != previous_block['hash']:
            return False
        if current_block['hash'] != self.hash_block(current_block):
            return False
        if not self.verify_signature(current_block):
            return False
    return True
```

## Типы данных блоков

### Genesis Block
```json
{
  "type": "genesis", 
  "message": "Genesis Block"
}
```

### Election Block
```json
{
  "type": "election",
  "title": "Название голосования",
  "candidates": {
    "Имя кандидата 1": {
      "user_id": "уникальный_id",
      "votes": 0,
      "age": 30,
      "citizenship": "Страна"
    },
    "Имя кандидата 2": {
      ...
    }
  }
}
```

### Vote Block
```json
{
  "type": "vote",
  "election_id": "id_голосования",
  "user_id": "id_пользователя",
  "candidate": "Имя кандидата"
}
```

## Требования к системе

- **Операционная система**: Любая (Windows, Linux, macOS)
- **Python**: 3.6+
- **Зависимости**:
  - Flask
  - Flask-SocketIO
  - RSA
  - Прочие стандартные библиотеки Python

## Рекомендации по развертыванию

1. **Установка зависимостей**:
   ```
   pip install flask flask-socketio rsa
   ```

2. **Запуск приложения**:
   ```
   python blc.py
   ```

3. **Доступ к приложению**:
   По умолчанию сервер запускается на порту 1000
   ```
   http://localhost:1000
   ```

## Ограничения и возможности для улучшения

1. **Масштабируемость**: Текущая реализация блокчейна хранит все данные в памяти, что ограничивает масштабируемость системы
2. **Безопасность ключей**: Ключи генерируются при запуске и хранятся в памяти
3. **Длина ключа RSA**: Используется 512-битный ключ RSA, для более высокой безопасности рекомендуется 2048+
4. **Отсутствие консенсусных алгоритмов**: Текущая реализация не включает механизмы консенсуса для распределенных систем

## Заключение

Данное приложение демонстрирует основные концепции и принципы работы блокчейна на примере системы голосований. Оно обеспечивает прозрачность, неизменяемость и верифицируемость результатов голосований, используя базовые криптографические принципы блокчейна.

Приложение может служить хорошей основой для понимания работы блокчейна и может быть расширено для обеспечения более высокой безопасности, масштабируемости и функциональности в реальных системах голосования.

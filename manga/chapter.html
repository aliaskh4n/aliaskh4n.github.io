<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ß—Ç–µ–Ω–∏–µ –≥–ª–∞–≤—ã - Manga App</title>
  <style>
    body {
      margin: 0;
      font-family: "Roboto-Black", Helvetica, sans-serif;
      background-color: #0d1117;
      color: #fff;
      padding: 0;
      user-select: none;
    }

    /* –®–∞–ø–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π */
    .chapter-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: rgba(13, 17, 23, 0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 15px;
      transition: transform 0.3s ease;
    }

    .chapter-header.hidden {
      transform: translateY(-100%);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .back-button {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s;
    }

    .back-button:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .chapter-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .manga-name {
      font-size: 16px;
      font-weight: 700;
      color: #fff;
    }

    .chapter-title {
      font-size: 12px;
      color: #999;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .chapter-counter {
      background: rgba(255, 255, 255, 0.1);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      color: #fff;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
    .chapter-container {
      margin-top: 60px;
      min-height: calc(100vh - 60px);
      background: #0d1117;
    }

    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 50vh;
      gap: 20px;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255,255,255,0.1);
      border-top: 3px solid #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error {
      background: rgba(255, 59, 48, 0.1);
      border: 1px solid rgba(255, 59, 48, 0.3);
      border-radius: 12px;
      padding: 20px;
      color: #ff3b30;
      text-align: center;
      margin: 20px;
    }

    /* –ö–æ–Ω—Ç–µ–Ω—Ç –≥–ª–∞–≤—ã */
    .chapter-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 0;
      gap: 5px;
    }

    .chapter-page {
      max-width: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
    }

    .chapter-page.loading {
      background: rgba(255,255,255,0.1);
      min-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255,255,255,0.5);
    }

    /* –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É –≥–ª–∞–≤–∞–º–∏ */
    .chapter-navigation {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      background: rgba(13, 17, 23, 0.95);
      backdrop-filter: blur(12px);
      padding: 12px 16px;
      border-radius: 25px;
      border: 1px solid rgba(255,255,255,0.1);
      transition: opacity 0.3s ease;
    }

    .chapter-navigation.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .nav-button {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 20px;
      padding: 10px 16px;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .nav-button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
    }

    .nav-button:disabled {
      background: rgba(255, 255, 255, 0.05);
      color: rgba(255,255,255,0.3);
      cursor: not-allowed;
      transform: none;
    }

    /* –¢–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≥–ª–∞–≤—ã */
    .text-content {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      font-size: 16px;
      background: rgba(255,255,255,0.02);
      border-radius: 12px;
      margin-bottom: 20px;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media(max-width: 768px) {
      .manga-name {
        font-size: 14px;
      }
      
      .chapter-title {
        font-size: 11px;
      }
      
      .header-left {
        gap: 10px;
      }
      
      .chapter-navigation {
        bottom: 15px;
        left: 15px;
        right: 15px;
        transform: none;
        justify-content: center;
      }
      
      .nav-button {
        flex: 1;
        justify-content: center;
        max-width: 120px;
      }
    }

    /* –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
    .fullscreen-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.95);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .fullscreen-overlay.active {
      display: flex;
    }

    .fullscreen-overlay img {
      max-width: 95%;
      max-height: 95%;
      object-fit: contain;
    }

    .fullscreen-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.1);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      color: #fff;
      cursor: pointer;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <!-- –®–∞–ø–∫–∞ -->
  <div class="chapter-header" id="chapterHeader">
    <div class="header-left">
      <button class="back-button" onclick="goBack()">
        ‚Üê –ù–∞–∑–∞–¥
      </button>
      <div class="chapter-info">
        <div class="manga-name" id="mangaName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="chapter-title" id="chapterTitle">–ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤—ã...</div>
      </div>
    </div>
    <div class="header-right">
      <div class="chapter-counter" id="chapterCounter">-/-</div>
    </div>
  </div>

  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
  <div class="chapter-container">
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div id="loadingDiv" class="loading">
      <div class="loading-spinner"></div>
      <div>–ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤—ã...</div>
    </div>

    <!-- –û—à–∏–±–∫–∞ -->
    <div id="errorDiv" class="error" style="display: none;"></div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≥–ª–∞–≤—ã -->
    <div id="chapterContent" class="chapter-content" style="display: none;"></div>
  </div>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div class="chapter-navigation" id="chapterNavigation">
    <button class="nav-button" id="prevButton" onclick="navigateChapter('prev')">
      ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è
    </button>
    <button class="nav-button" id="nextButton" onclick="navigateChapter('next')">
      –°–ª–µ–¥—É—é—â–∞—è ‚Üí
    </button>
  </div>

  <!-- –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä -->
  <div class="fullscreen-overlay" id="fullscreenOverlay" onclick="closeFullscreen()">
    <button class="fullscreen-close" onclick="closeFullscreen()">√ó</button>
    <img id="fullscreenImg" src="" alt="">
  </div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
    const API_CONFIG = {
      baseUrl: 'https://nekros.tatokz2006.workers.dev',
      timeout: 15000
    };

    let currentMangaData = null;
    let currentChapterData = null;
    let isHeaderVisible = true;
    let lastScrollY = 0;

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL
    function getUrlParams() {
      const urlParams = new URLSearchParams(window.location.search);
      return {
        mangaId: urlParams.get('manga'),
        chapterId: urlParams.get('chapter')
      };
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–∑–∞–¥
    function goBack() {
      const params = getUrlParams();
      if (params.mangaId) {
        window.location.href = `info.html?id=${params.mangaId}`;
      } else {
        window.location.href = 'index.html';
      }
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≥–ª–∞–≤—ã —Å API
    async function fetchChapterData(mangaId, chapterId) {
      try {
        console.log(`–ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –≥–ª–∞–≤—ã: manga=${mangaId}, chapter=${chapterId}`);
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), API_CONFIG.timeout);
        
        // –°–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–µ–º—É worker: ?id={mangaId}&cr={chapterId}
        const url = `${API_CONFIG.baseUrl}/?id=${mangaId}&cr=${chapterId}`;
        console.log(`–ó–∞–ø—Ä–æ—Å –∫: ${url}`);
        
        const response = await fetch(url, {
          signal: controller.signal,
          headers: {
            'Accept': 'application/json',
            'Origin': window.location.origin
          }
        });
        
        clearTimeout(timeoutId);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('–î–∞–Ω–Ω—ã–µ –≥–ª–∞–≤—ã –ø–æ–ª—É—á–µ–Ω—ã:', data);
        return data;
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≥–ª–∞–≤—ã:', error);
        throw error;
      }
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞–Ω–≥–µ (–¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É –≥–ª–∞–≤–∞–º–∏)
    async function fetchMangaInfo(mangaId) {
      try {
        const url = `${API_CONFIG.baseUrl}/?id=${mangaId}`;
        const response = await fetch(url);
        
        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞–Ω–≥–µ');
        
        return await response.json();
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞–Ω–≥–µ:', error);
        return null;
      }
    }

    // –ü–æ–∫–∞–∑ –æ—à–∏–±–∫–∏
    function showError(message) {
      document.getElementById('loadingDiv').style.display = 'none';
      document.getElementById('chapterContent').style.display = 'none';
      
      const errorDiv = document.getElementById('errorDiv');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≥–ª–∞–≤—ã
    function displayChapterContent(chapterData) {
      const contentContainer = document.getElementById('chapterContent');
      contentContainer.innerHTML = '';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
      document.getElementById('mangaName').textContent = chapterData.mangaName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –º–∞–Ω–≥–∞';
      
      // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥–ª–∞–≤–µ –∏–∑ chapterContent (—ç—Ç–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON —Ñ–∞–π–ª–∞)
      const chapterInfo = chapterData.chapterContent || {};
      const chapterTitle = chapterInfo.title || `–ì–ª–∞–≤–∞ ${chapterInfo.id || chapterInfo.chapter}`;
      document.getElementById('chapterTitle').textContent = chapterTitle;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      document.title = `${chapterTitle} - ${chapterData.mangaName} - Manga App`;

      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
      if (chapterInfo.translators) {
        const translatorsDiv = document.createElement('div');
        translatorsDiv.className = 'translators-info';
        translatorsDiv.style.cssText = `
          background: rgba(255, 255, 255, 0.05);
          padding: 15px;
          margin-bottom: 20px;
          border-radius: 12px;
          text-align: center;
          border: 1px solid rgba(255,255,255,0.1);
        `;
        
        let translatorsHtml = `<div style="color: #ffcc00; font-weight: bold; margin-bottom: 8px;">–ü–µ—Ä–µ–≤–æ–¥:</div>`;
        translatorsHtml += `<div style="color: #fff; font-size: 14px;">${chapterInfo.translators.name}</div>`;
        
        if (chapterInfo.translators.tme || chapterInfo.translators.vk) {
          translatorsHtml += `<div style="margin-top: 8px; display: flex; justify-content: center; gap: 15px;">`;
          
          if (chapterInfo.translators.tme) {
            translatorsHtml += `<a href="https://${chapterInfo.translators.tme}" target="_blank" style="color: #00aced; text-decoration: none; font-size: 12px;">üì± Telegram</a>`;
          }
          
          if (chapterInfo.translators.vk) {
            translatorsHtml += `<a href="https://${chapterInfo.translators.vk}" target="_blank" style="color: #4680c2; text-decoration: none; font-size: 12px;">üî∑ VKontakte</a>`;
          }
          
          translatorsHtml += `</div>`;
        }
        
        translatorsDiv.innerHTML = translatorsHtml;
        contentContainer.appendChild(translatorsDiv);
      }

      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≥–ª–∞–≤—ã
      const pages = chapterInfo.pages;
      
      if (!pages || !Array.isArray(pages) || pages.length === 0) {
        contentContainer.innerHTML += '<div class="text-content">–°—Ç—Ä–∞–Ω–∏—Ü—ã –≥–ª–∞–≤—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
        return;
      }

      console.log(`–ó–∞–≥—Ä—É–∂–∞–µ–º ${pages.length} —Å—Ç—Ä–∞–Ω–∏—Ü`);

      // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      pages.forEach((pageUrl, index) => {
        createImageElement(pageUrl, index + 1, contentContainer);
      });

      // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∫–æ–Ω—Ü–µ –≥–ª–∞–≤—ã
      if (chapterInfo.views || chapterInfo.likes || chapterInfo.release_date) {
        const footerDiv = document.createElement('div');
        footerDiv.className = 'chapter-footer';
        footerDiv.style.cssText = `
          background: rgba(255, 255, 255, 0.05);
          padding: 20px;
          margin-top: 30px;
          border-radius: 12px;
          text-align: center;
          border: 1px solid rgba(255,255,255,0.1);
          color: #999;
          font-size: 14px;
        `;
        
        let footerHtml = '';
        if (chapterInfo.release_date) {
          footerHtml += `<div>üìÖ –î–∞—Ç–∞ –≤—ã–ø—É—Å–∫–∞: ${chapterInfo.release_date}</div>`;
        }
        if (chapterInfo.views) {
          footerHtml += `<div>üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã: ${chapterInfo.views}</div>`;
        }
        if (chapterInfo.likes) {
          footerHtml += `<div>‚ù§Ô∏è –õ–∞–π–∫–∏: ${chapterInfo.likes}</div>`;
        }
        
        footerDiv.innerHTML = footerHtml;
        contentContainer.appendChild(footerDiv);
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
      document.getElementById('loadingDiv').style.display = 'none';
      document.getElementById('chapterContent').style.display = 'flex';
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    function createImageElement(imageSrc, pageNumber, container) {
      const pageContainer = document.createElement('div');
      pageContainer.style.cssText = `
        position: relative;
        margin-bottom: 10px;
        width: 100%;
        max-width: 800px;
      `;
      
      // –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      const pageLabel = document.createElement('div');
      pageLabel.style.cssText = `
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        z-index: 10;
        pointer-events: none;
      `;
      pageLabel.textContent = `${pageNumber}`;
      
      const img = document.createElement('img');
      img.className = 'chapter-page loading';
      img.alt = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${pageNumber}`;
      img.style.cssText = `
        width: 100%;
        height: auto;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.2s;
      `;
      
      // –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
      img.style.minHeight = '400px';
      img.style.background = 'rgba(255,255,255,0.1)';
      img.style.display = 'flex';
      img.style.alignItems = 'center';
      img.style.justifyContent = 'center';
      
      img.onload = () => {
        img.classList.remove('loading');
        img.style.minHeight = 'auto';
        img.style.background = 'none';
        pageContainer.appendChild(pageLabel);
      };
      
      img.onerror = () => {
        img.classList.remove('loading');
        img.style.minHeight = '200px';
        img.style.background = 'rgba(255, 59, 48, 0.1)';
        img.style.border = '2px dashed rgba(255, 59, 48, 0.3)';
        img.style.color = '#ff3b30';
        img.style.display = 'flex';
        img.style.alignItems = 'center';
        img.style.justifyContent = 'center';
        img.textContent = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${pageNumber}`;
        img.style.cursor = 'default';
      };

      // –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏ –∫–ª–∏–∫–µ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å)
      img.onclick = () => {
        if (!img.classList.contains('loading') && !img.textContent) {
          openFullscreen(imageSrc);
        }
      };

      // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
      img.onmouseenter = () => {
        if (!img.classList.contains('loading') && !img.textContent) {
          img.style.transform = 'scale(1.02)';
        }
      };
      
      img.onmouseleave = () => {
        img.style.transform = 'scale(1)';
      };
      
      img.src = imageSrc;
      pageContainer.appendChild(img);
      container.appendChild(pageContainer);
    }

    // –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
    function openFullscreen(imageSrc) {
      const overlay = document.getElementById('fullscreenOverlay');
      const img = document.getElementById('fullscreenImg');
      img.src = imageSrc;
      overlay.classList.add('active');
    }

    function closeFullscreen() {
      document.getElementById('fullscreenOverlay').classList.remove('active');
    }

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É –≥–ª–∞–≤–∞–º–∏
    function navigateChapter(direction) {
      const params = getUrlParams();
      if (!currentMangaData || !params.mangaId) return;
      
      const chapters = currentMangaData.chapters || [];
      const currentIndex = chapters.findIndex(ch => ch.id == params.chapterId);
      
      if (currentIndex === -1) return;
      
      let newIndex;
      if (direction === 'next') {
        newIndex = currentIndex + 1;
      } else {
        newIndex = currentIndex - 1;
      }
      
      if (newIndex >= 0 && newIndex < chapters.length) {
        const newChapterId = chapters[newIndex].id;
        window.location.href = `chapter.html?manga=${params.mangaId}&chapter=${newChapterId}`;
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    function updateNavigation() {
      const params = getUrlParams();
      if (!currentMangaData || !params.chapterId) return;
      
      const chapters = currentMangaData.chapters || [];
      const currentIndex = chapters.findIndex(ch => ch.id == params.chapterId);
      
      if (currentIndex !== -1) {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
        document.getElementById('chapterCounter').textContent = `${currentIndex + 1}/${chapters.length}`;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        
        prevButton.disabled = currentIndex === 0;
        nextButton.disabled = currentIndex === chapters.length - 1;
      }
    }

    // –°–∫—Ä—ã—Ç–∏–µ/–ø–æ–∫–∞–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
    function handleScroll() {
      const currentScrollY = window.scrollY;
      const header = document.getElementById('chapterHeader');
      const navigation = document.getElementById('chapterNavigation');
      
      if (currentScrollY > lastScrollY && currentScrollY > 100) {
        // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑ - —Å–∫—Ä—ã–≤–∞–µ–º
        header.classList.add('hidden');
        navigation.classList.add('hidden');
        isHeaderVisible = false;
      } else {
        // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–≤–µ—Ä—Ö - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
        header.classList.remove('hidden');
        navigation.classList.remove('hidden');
        isHeaderVisible = true;
      }
      
      lastScrollY = currentScrollY;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    async function loadChapter() {
      const params = getUrlParams();
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
      if (!params.mangaId || !params.chapterId) {
        showError('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–ª–∞–≤—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã –≤ URL. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ —Å–ø–∏—Å–∫—É –º–∞–Ω–≥–∏.');
        return;
      }
      
      try {
        console.log(`–ó–∞–≥—Ä—É–∂–∞–µ–º –≥–ª–∞–≤—É ${params.chapterId} –º–∞–Ω–≥–∏ ${params.mangaId}`);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≥–ª–∞–≤—ã
        const chapterData = await fetchChapterData(params.mangaId, params.chapterId);
        currentChapterData = chapterData;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞–Ω–≥–µ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        currentMangaData = await fetchMangaInfo(params.mangaId);
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
        displayChapterContent(chapterData);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
        updateNavigation();
        
      } catch (error) {
        let errorMessage = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–ª–∞–≤—ã: ';
        
        if (error.name === 'AbortError') {
          errorMessage += '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è';
        } else if (error.message.includes('HTTP error')) {
          errorMessage += '–ì–ª–∞–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
        } else if (error.message.includes('fetch')) {
          errorMessage += '–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ —Å–µ—Ä–≤–µ—Ä—É';
        } else {
          errorMessage += error.message;
        }
        
        showError(errorMessage + '. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      loadChapter();
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Å –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–æ–º
      let scrollTimeout;
      window.addEventListener('scroll', () => {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(handleScroll, 10);
      });
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') {
          navigateChapter('prev');
        } else if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') {
          navigateChapter('next');
        } else if (e.key === 'Escape') {
          closeFullscreen();
        }
      });
    });
  </script>
</body>
</html>

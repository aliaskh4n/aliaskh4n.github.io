!function(){let e=null,t={};function n(){document.querySelector(".loading-overlay").classList.add("active")}function o(){document.querySelector(".loading-overlay").classList.remove("active")}function a(n,o,a,l,i){const r=document.getElementById("networkVisualization");r.innerHTML="";const s=[],c=[];t={},s.push({id:1,label:"OLT",shape:"box",color:{background:"#3B82F6",border:"#2563EB",highlight:{background:"#60A5FA",border:"#3B82F6"}},font:{color:"white"}}),t[1]={label:"OLT",details:{type:"Оптический линейный терминал",Порты:"16 GPON портов","Пропускная способность":"10 Гбит/с","Мощность передатчика":"+5 дБм"}};for(let e=0;e<n;e++){const o=document.getElementById("splitRatio").value;s.push({id:e+2,label:`Сплиттер ${e+1}`,shape:"circle",color:{background:"#10B981",border:"#059669",highlight:{background:"#34D399",border:"#10B981"}}}),c.push({from:1,to:e+2,width:2}),t[e+2]={label:`Сплиттер ${e+1}`,details:{type:"Оптический сплиттер","Коэффициент деления":o,"Вносимые потери":"17.5 дБ",Тип:"PLC сплиттер"}}}const d=Math.ceil(o/n);let u=0;for(let e=0;e<n;e++)for(let a=0;a<d;a++)if(u<o){const o=n+2+u;s.push({id:o,label:`ONT ${u+1}`,shape:"circle",color:{background:"#E5E7EB",border:"#9CA3AF",highlight:{background:"#F3F4F6",border:"#D1D5DB"}},size:15}),c.push({from:e+2,to:o}),t[o]={label:`ONT ${u+1}`,details:{type:"Оптический сетевой терминал",Скорость:"1 Гбит/с","Чувствительность приемника":"-28 дБм",Статус:"Активен"}},u++}if("ring"===a){for(let e=0;e<n-1;e++)c.push({from:e+2,to:e+3,color:{color:"#94A3B8",opacity:.6},dashes:[5,5]});c.push({from:n+1,to:2,color:{color:"#94A3B8",opacity:.6},dashes:[5,5]})}else if("mesh"===a)for(let e=0;e<n;e++)for(let t=e+1;t<n;t++)Math.random()>.5&&c.push({from:e+2,to:t+2,color:{color:"#94A3B8",opacity:.4},dashes:[5,5]});const p={nodes:new vis.DataSet(s),edges:new vis.DataSet(c)},m={nodes:{shape:"dot",size:25,font:{size:14},borderWidth:2,shadow:!0},edges:{width:2,smooth:{type:"continuous"},shadow:!0},physics:{enabled:!0,stabilization:{iterations:200},barnesHut:{gravitationalConstant:-8e4,springConstant:.001,springLength:200}},layout:{hierarchical:{enabled:"tree"===a,direction:"UD",sortMethod:"directed",nodeSpacing:150,levelSeparation:200}},interaction:{hover:!0,tooltipDelay:200,zoomView:!0,dragView:!0},height:"100%",width:"100%"};e=new vis.Network(r,p,m),e.once("stabilized",(function(){e.fit({animation:{duration:1e3,easingFunction:"easeInOutQuad"}})}));const h=document.getElementById("nodeInfo");e.on("hoverNode",(function(e){const n=t[e.node];if(n&&n.details){const t=n.details;h.innerHTML=`\n                <h3>${n.label}</h3>\n                <p><strong>Тип:</strong> ${t.type}</p>\n                ${Object.entries(t).filter((([e])=>"type"!==e)).map((([e,t])=>`<p><strong>${e}:</strong> ${t}</p>`)).join("")}\n            `,h.style.display="block",h.style.left=e.event.clientX+10+"px",h.style.top=e.event.clientY+10+"px"}})),e.on("blurNode",(function(){h.style.display="none"}));const g=document.getElementById("splitRatio").value;f(s.length,o,l,i,n,g),window.addEventListener("resize",(function(){e&&e.fit({animation:{duration:1e3,easingFunction:"easeInOutQuad"}})}))}function l(){n(),setTimeout((()=>{var t=document.getElementById("projectName").value||"Проект GPON",n=document.getElementById("settlementType").value,l=document.getElementById("householdsCount").value,i=document.getElementById("networkTopology").value,r=document.getElementById("maxDistance").value,s=document.getElementById("splitRatio").value;if(l=l?parseInt(l,10):0,r=r?parseFloat(r):0,l<=0||r<=0)return alert("Пожалуйста, введите корректные значения"),void o();var c=parseInt(s.split(":")[1],10),d=Math.ceil(.8*l),u=Math.ceil(d/c),p=.05*l,m={tree:1,ring:1.2,mesh:1.5},h=Math.round(p*m[i]),g=2e3,b=5e4,v=5e3,y=Math.round(d*g+b+u*v);document.getElementById("designResults").innerHTML=`\n            <div class="result-item">\n                <span class="result-label">Название проекта</span>\n                <span class="result-value">${t}</span>\n            </div>\n            <div class="result-item">\n                <span class="result-label">Тип населенного пункта</span>\n                <span class="result-value">${"urban"===n?"Городской район":"suburban"===n?"Пригородный поселок":"Сельская местность"}</span>\n            </div>\n            <div class="result-item">\n                <span class="result-label">Количество домохозяйств</span>\n                <span class="result-value">${l}</span>\n            </div>\n            <div class="result-item">\n                <span class="result-label">Топология сети</span>\n                <span class="result-value">${"tree"===i?"Древовидная":"ring"===i?"Кольцевая":"Ячеистая"}</span>\n            </div>\n            <div class="result-item">\n                <span class="result-label">Максимальное расстояние до OLT</span>\n                <span class="result-value">${r} км</span>\n            </div>\n            <div class="result-item">\n                <span class="result-label">Коэффициент сплиттера</span>\n                <span class="result-value">${s}</span>\n            </div>\n            <div class="result-item">\n                <span class="result-label">Количество ONT</span>\n                <span class="result-value">${d}</span>\n            </div>\n            <div class="result-item">\n                <span class="result-label">Количество оптических узлов</span>\n                <span class="result-value">${u}</span>\n            </div>\n            <div class="result-item">\n                <span class="result-label">Расчетная длина кабеля</span>\n                <span class="result-value">${h} м</span>\n            </div>\n            <div class="result-item">\n                <span class="result-label">Оценочная стоимость оборудования</span>\n                <span class="result-value">${y.toLocaleString("ru-RU")} руб.</span>\n            </div>\n        `,a(u,d,i,y,l),document.getElementById("resultContainer").style.display="block",document.querySelectorAll(".tab").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".content-section").forEach((e=>e.classList.remove("active"))),document.querySelector('[data-tab="visualization"]').classList.add("active"),document.getElementById("visualization").classList.add("active"),f(u+d+1,d,y,l,u,s),o()}),500)}function f(e,t,n,o,a,l){document.getElementById("totalDevices").textContent=e,document.getElementById("coverage").textContent=Math.round(t/o*100)+"%",document.getElementById("costPerUser").textContent=Math.round(n/o)+" руб.",document.getElementById("detailedInfo").innerHTML=`\n        <h3 style="margin-bottom: 15px; color: var(--primary-color);">Детальная информация о сети</h3>\n        <div class="results-grid">\n            <div class="result-item">\n                <span class="result-label">Общее количество устройств в сети</span>\n                <span class="result-value">${e}</span>\n            </div>\n            <div class="result-item">\n                <span class="result-label">Процент покрытия домохозяйств</span>\n                <span class="result-value">${Math.round(t/o*100)}%</span>\n            </div>\n            <div class="result-item">\n                <span class="result-label">Средняя стоимость на абонента</span>\n                <span class="result-value">${Math.round(n/o)} руб.</span>\n            </div>\n            <div class="result-item">\n                <span class="result-label">Эффективность использования сплиттеров</span>\n                <span class="result-value">${Math.round(t/(a*parseInt(l.split(":")[1],10))*100)}%</span>\n            </div>\n        </div>\n    `}function calculateNetworkParameters(){l()}function zoomIn(){e&&e.zoom(1.2)}function zoomOut(){e&&e.zoom(.8)}function resetView(){e&&e.fit({animation:{duration:1e3,easingFunction:"easeInOutQuad"}})}document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".tab").forEach((e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-tab");document.querySelectorAll(".tab").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".content-section").forEach((e=>e.classList.remove("active"))),this.classList.add("active"),document.getElementById(e).classList.add("active")}))})),document.getElementById("calculateBtn").addEventListener("click",l),document.getElementById("zoomIn").addEventListener("click",zoomIn),document.getElementById("zoomOut").addEventListener("click",zoomOut),document.getElementById("resetView").addEventListener("click",resetView)}))}(); 
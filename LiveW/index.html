<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ–º–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å JSON –¥–∞–Ω–Ω—ã–º–∏</title>
    <style>
        body {
            background: #0f1119;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: monospace;
            color: #e0e0e0;
        }
        .glass-container {
            width: 450px;
            background: rgba(30, 34, 51, 0.4);
            border-radius: 15px;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
            padding: 25px;
        }
        .json-display {
            width: 100%;
            line-height: 1.6;
            font-size: 16px;
            margin: 0;
            white-space: pre-wrap;
            color: #bdc7d8;
        }
        .json-key { color: #73c990; }
        .json-string { color: #ff98a4; }
        .json-bracket { color: #c39ac9; }
        .json-colon { color: #79b8ff; margin-right: 8px; }
        .json-comma { color: #79b8ff; }
        .time-container {
            display: inline-block;
            padding: 2px 4px;
            background: rgba(121, 184, 255, 0.1);
            border-radius: 4px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { background: rgba(121, 184, 255, 0.1); }
            50% { background: rgba(121, 184, 255, 0.2); }
        }
        
        .shape {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, #5151cf, #2d348e);
            opacity: 0.15;
            z-index: -1;
        }
        
        .shape:nth-child(1) {
            width: 300px;
            height: 300px;
            top: 20%;
            left: 25%;
            animation: float 15s infinite;
        }
        
        .shape:nth-child(2) {
            width: 250px;
            height: 250px;
            bottom: 15%;
            right: 30%;
            animation: float 20s infinite reverse;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-10px, 15px) rotate(5deg); }
        }
    </style>
</head>
<body>
    <div class="shape"></div>
    <div class="shape"></div>
    
    <div class="glass-container">
        <pre id="json-content" class="json-display"></pre>
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const name = urlParams.get('name') || "Aliaskhan";
        const city = urlParams.get('city') || "–ö–æ–∫—à–µ—Ç–∞—É";

        // API –∫–ª—é—á –æ—Ç OpenWeatherMap (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π)
        const apiKey = "–í–ê–®_API_–ö–õ–Æ–ß";
        const weatherApiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=ru`;

        // –î–∞–Ω–Ω—ã–µ
        const data = {
            city: city,
            date: new Date().toLocaleDateString('ru-RU'),
            time: new Date().toLocaleTimeString('ru-RU'),
            weather: "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞..."
        };

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSON —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
        function formatJSON(json) {
            return JSON.stringify(json, null, 4)
                .replace(/"([^"]+)":/g, '<span class="json-key">"$1"</span><span class="json-colon">:</span>')
                .replace(/: "([^"]+)"/g, ': <span class="json-string">"$1"</span>')
                .replace(/,/g, '<span class="json-comma">,</span>')
                .replace(/\{/g, '<span class="json-bracket">{</span>')
                .replace(/\}/g, '<span class="json-bracket">}</span>')
                .replace(/"time": <span class="json-string">"([^"]+)"<\/span>/g, 
                    '"time": <span class="json-string time-container">"$1"</span>');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function updateTime() {
            data.time = new Date().toLocaleTimeString('ru-RU');
            renderJSON();
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã –ø–æ API
        async function fetchWeather() {
            try {
                const response = await fetch(weatherApiUrl);
                if (!response.ok) {
                    throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ");
                }
                const weatherData = await response.json();
                const weatherDescription = weatherData.weather[0].description;
                const temperature = Math.round(weatherData.main.temp);
                const emoji = getWeatherEmoji(weatherData.weather[0].id);

                data.weather = `${emoji} ${temperature} ¬∞C, ${weatherDescription}`;
                renderJSON();

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ –≤ localStorage
                localStorage.setItem('lastWeatherUpdate', Date.now().toString());
                localStorage.setItem('cachedWeather', data.weather);
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–≥–æ–¥—ã:", error);
                data.weather = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–≥–æ–¥—ã";
                renderJSON();
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –¥–ª—è –ø–æ–≥–æ–¥—ã
        function getWeatherEmoji(weatherId) {
            if (weatherId >= 200 && weatherId < 300) return "‚õàÔ∏è"; // –ì—Ä–æ–∑–∞
            if (weatherId >= 300 && weatherId < 500) return "üåßÔ∏è"; // –ú–µ–ª–∫–∏–π –¥–æ–∂–¥—å
            if (weatherId >= 500 && weatherId < 600) return "üåßÔ∏è"; // –î–æ–∂–¥—å
            if (weatherId >= 600 && weatherId < 700) return "‚ùÑÔ∏è"; // –°–Ω–µ–≥
            if (weatherId === 800) return "‚òÄÔ∏è"; // –Ø—Å–Ω–æ
            if (weatherId > 800) return "‚òÅÔ∏è"; // –û–±–ª–∞—á–Ω–æ
            return "üåç"; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ JSON
        function renderJSON() {
            const jsonData = {
                [name]: {
                    "data": data.date,
                    "time": data.time,
                    "weather": data.weather,
                    "city": data.city
                }
            };
            document.getElementById('json-content').innerHTML = formatJSON(jsonData);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            setInterval(updateTime, 1000);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–≥–æ–¥—É
            const lastUpdate = localStorage.getItem('lastWeatherUpdate');
            if (!lastUpdate || (Date.now() - parseInt(lastUpdate) > 3600000)) {
                fetchWeather();
            } else {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –ø–æ–≥–æ–¥—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
                const savedWeather = localStorage.getItem('cachedWeather');
                if (savedWeather) {
                    data.weather = savedWeather;
                } else {
                    fetchWeather();
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–≥–æ–¥—É –∫–∞–∂–¥—ã–π —á–∞—Å
            setInterval(fetchWeather, 3600000);
            
            // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
            renderJSON();
        }

        // –ó–∞–ø—É—Å–∫
        init();
    </script>
</body>
</html>

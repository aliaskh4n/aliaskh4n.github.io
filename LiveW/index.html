<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ–º–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å JSON –¥–∞–Ω–Ω—ã–º–∏</title>
    <style>
        body {
            background: linear-gradient(45deg, #1a1d2e, #0f1119);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: monospace;
            color: #e0e0e0;
        }
        
        .glass-container {
            width: 450px;
            background: rgba(30, 34, 51, 0.4);
            border-radius: 15px;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            padding: 25px;
        }
        
        .json-display {
            width: 100%;
            text-align: left;
            line-height: 1.6;
            font-size: 16px;
            margin: 0;
            white-space: pre-wrap;
            color: #bdc7d8;
        }
        
        .json-key { color: #73c990; }
        .json-string { color: #ff98a4; }
        .json-bracket { color: #c39ac9; }
        .json-colon { color: #79b8ff; margin-right: 8px; }
        .json-comma { color: #79b8ff; }
        
        .time-container {
            display: inline-block;
            padding: 2px 4px;
            background: rgba(121, 184, 255, 0.1);
            border-radius: 4px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { background: rgba(121, 184, 255, 0.1); }
            50% { background: rgba(121, 184, 255, 0.2); }
        }
        
        .shape {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, #5151cf, #2d348e);
            opacity: 0.15;
            z-index: -1;
        }
        
        .shape:nth-child(1) {
            width: 300px;
            height: 300px;
            top: 20%;
            left: 25%;
            animation: float 15s infinite;
        }
        
        .shape:nth-child(2) {
            width: 250px;
            height: 250px;
            bottom: 15%;
            right: 30%;
            animation: float 20s infinite reverse;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-10px, 15px) rotate(5deg); }
        }
    </style>
</head>
<body>
    <div class="shape"></div>
    <div class="shape"></div>
    
    <div class="glass-container">
        <pre id="json-content" class="json-display"></pre>
    </div>

    <script>
        // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        const cachedData = {
            date: "",
            time: "",
            weather: "‚è≥ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è...",
            city: "üîç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞..."
        };

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
        function getCurrentDateTime() {
            const now = new Date();
            return {
                date: now.toLocaleDateString('ru-RU'),
                time: now.toLocaleTimeString('ru-RU')
            };
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
        function getGeolocation() {
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        position => resolve({ 
                            lat: position.coords.latitude, 
                            lon: position.coords.longitude 
                        }),
                        () => resolve({ lat: null, lon: null }),
                        { timeout: 10000, maximumAge: 3600000 }
                    );
                } else {
                    resolve({ lat: null, lon: null });
                }
            });
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
        async function getCityByCoords(lat, lon) {
            if (!lat || !lon) return "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
            
            try {
                const cacheKey = `city_${lat.toFixed(3)}_${lon.toFixed(3)}`;
                const cacheTimeKey = `${cacheKey}_time`;
                
                const cachedCity = localStorage.getItem(cacheKey);
                const cachedTime = localStorage.getItem(cacheTimeKey);
                
                if (cachedCity && cachedTime && (Date.now() - parseInt(cachedTime) < 3600000)) {
                    return cachedCity;
                }
                
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=ru`);
                const data = await response.json();
                
                const city = data.address?.city || 
                             data.address?.town || 
                             data.address?.village || 
                             data.address?.county || 
                             "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
                
                localStorage.setItem(cacheKey, city);
                localStorage.setItem(cacheTimeKey, Date.now().toString());
                
                return city;
            } catch (error) {
                const cacheKey = `city_${lat.toFixed(3)}_${lon.toFixed(3)}`;
                return localStorage.getItem(cacheKey) || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã —Å —ç–º–æ–¥–∑–∏
        async function getWeather(lat, lon) {
            if (!lat || !lon) return "üîç –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
            
            try {
                const cacheKey = `weather_${lat.toFixed(3)}_${lon.toFixed(3)}`;
                const cacheTimeKey = `${cacheKey}_time`;
                
                const cachedWeather = localStorage.getItem(cacheKey);
                const cachedTime = localStorage.getItem(cacheTimeKey);
                
                if (cachedWeather && cachedTime && (Date.now() - parseInt(cachedTime) < 3600000)) {
                    return cachedWeather;
                }
                
                // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –ø–æ–≥–æ–¥—ã
                const temp = Math.floor(Math.random() * 15) + 10;
                const conditions = [
                    { text: "—è—Å–Ω–æ", emoji: "‚òÄÔ∏è" },
                    { text: "–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å", emoji: "üå§Ô∏è" },
                    { text: "–æ–±–ª–∞—á–Ω–æ", emoji: "‚òÅÔ∏è" },
                    { text: "–Ω–µ–±–æ–ª—å—à–æ–π –¥–æ–∂–¥—å", emoji: "üåßÔ∏è" },
                    { text: "—Å–æ–ª–Ω–µ—á–Ω–æ", emoji: "üòé" },
                    { text: "—Ç—É–º–∞–Ω", emoji: "üå´Ô∏è" },
                    { text: "–≥—Ä–æ–∑–∞", emoji: "‚õàÔ∏è" },
                    { text: "—Å–Ω–µ–≥", emoji: "‚ùÑÔ∏è" }
                ];
                const randomCondition = conditions[Math.floor(Math.random() * conditions.length)];
                
                const weather = `${randomCondition.emoji} ${temp} ¬∞C, ${randomCondition.text}`;
                
                localStorage.setItem(cacheKey, weather);
                localStorage.setItem(cacheTimeKey, Date.now().toString());
                
                return weather;
            } catch (error) {
                const cacheKey = `weather_${lat.toFixed(3)}_${lon.toFixed(3)}`;
                return localStorage.getItem(cacheKey) || "‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã";
            }
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSON —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
        function formatJSON(json) {
            return JSON.stringify(json, null, 4)
                .replace(/"([^"]+)":/g, '<span class="json-key">"$1"</span><span class="json-colon">:</span>')
                .replace(/: "([^"]+)"/g, ': <span class="json-string">"$1"</span>')
                .replace(/,/g, '<span class="json-comma">,</span>')
                .replace(/\{/g, '<span class="json-bracket">{</span>')
                .replace(/\}/g, '<span class="json-bracket">}</span>')
                .replace(/"time": <span class="json-string">"([^"]+)"<\/span>/g, 
                    '"time": <span class="json-string time-container">"$1"</span>');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ JSON –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function updateJSON() {
            const dateTime = getCurrentDateTime();
            cachedData.time = dateTime.time;
            
            const jsonData = {
                "Aliaskhan": {
                    "data": cachedData.date,
                    "time": cachedData.time,
                    "weather": cachedData.weather,
                    "city": cachedData.city
                }
            };
            
            document.getElementById('json-content').innerHTML = formatJSON(jsonData);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function initialize() {
            const dateTime = getCurrentDateTime();
            cachedData.date = dateTime.date;
            cachedData.time = dateTime.time;
            
            let coords;
            const savedLat = localStorage.getItem('lat');
            const savedLon = localStorage.getItem('lon');
            
            if (savedLat && savedLon) {
                coords = { lat: parseFloat(savedLat), lon: parseFloat(savedLon) };
            } else {
                coords = await getGeolocation();
                
                if (coords.lat && coords.lon) {
                    localStorage.setItem('lat', coords.lat.toString());
                    localStorage.setItem('lon', coords.lon.toString());
                }
            }
            
            if (coords.lat && coords.lon) {
                cachedData.city = await getCityByCoords(coords.lat, coords.lon);
                cachedData.weather = await getWeather(coords.lat, coords.lon);
                localStorage.setItem('last_update', Date.now().toString());
            } else {
                cachedData.city = "‚ùì –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å";
                cachedData.weather = "üîç –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
            }
            
            updateJSON();
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            setInterval(updateJSON, 1000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            
            setInterval(() => {
                cachedData.date = getCurrentDateTime().date;
            }, 3600000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—ã –∫–∞–∂–¥—ã–π —á–∞—Å
            
            setInterval(async () => {
                const lastUpdate = localStorage.getItem('last_update');
                if (!lastUpdate || (Date.now() - parseInt(lastUpdate) >= 3600000)) {
                    if (coords.lat && coords.lon) {
                        cachedData.city = await getCityByCoords(coords.lat, coords.lon);
                        cachedData.weather = await getWeather(coords.lat, coords.lon);
                        localStorage.setItem('last_update', Date.now().toString());
                        updateJSON();
                    }
                }
            }, 300000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
        }

        // –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        initialize();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ–º–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å JSON –¥–∞–Ω–Ω—ã–º–∏</title>
    <style>
        body {
            background: #0f1119;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: monospace;
            color: #e0e0e0;
            overflow: hidden;
        }
        
        .glass-container {
            width: 450px;
            background: rgba(30, 34, 51, 0.4);
            border-radius: 15px;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
            padding: 25px;
        }
        
        .json-display {
            width: 100%;
            line-height: 1.6;
            font-size: 16px;
            margin: 0;
            white-space: pre-wrap;
            color: #bdc7d8;
            overflow: hidden;
        }
        
        .json-key { color: #73c990; }
        .json-string { color: #ff98a4; }
        .json-bracket { color: #c39ac9; }
        .json-colon { color: #79b8ff; margin-right: 8px; }
        .json-comma { color: #79b8ff; }
        
        .time-container {
            display: inline-block;
            padding: 2px 4px;
            background: rgba(121, 184, 255, 0.1);
            border-radius: 4px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { background: rgba(121, 184, 255, 0.1); }
            50% { background: rgba(121, 184, 255, 0.2); }
        }
        
        .shape {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, #5151cf, #2d348e);
            opacity: 0.15;
            z-index: -1;
        }
        
        .shape:nth-child(1) {
            width: 300px;
            height: 300px;
            top: 20%;
            left: 25%;
            animation: float 15s infinite;
        }
        
        .shape:nth-child(2) {
            width: 250px;
            height: 250px;
            bottom: 15%;
            right: 30%;
            animation: float 20s infinite reverse;
        }

        .no-params {
            text-align: center;
            font-size: 18px;
            color: #ff98a4;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-10px, 15px) rotate(5deg); }
        }
    </style>
</head>
<body>
    <div class="shape"></div>
    <div class="shape"></div>
    
    <div class="glass-container" id="container">
        <pre id="json-content" class="json-display"></pre>
    </div>

    <script>
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const userName = urlParams.get('username');
        const userCity = urlParams.get('city');

        // –°–ª–æ–≤–∞—Ä—å –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏–∏ –≥–æ—Ä–æ–¥–æ–≤
        const cityMapping = {
            'kokshetay': 'Kokshetau',   // –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
            '–∫–æ–∫—à–µ—Ç–∞—É': 'Kokshetau',
            'koksetau': 'Kokshetau',
            '–∫–æ–∫—á–µ—Ç–∞–≤': 'Kokshetau',
            'kokchetav': 'Kokshetau'
        };

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        if (!userName || !userCity) {
            document.getElementById('container').innerHTML = `
                <div class="no-params">
                    <p>–î–ª—è —Ä–∞–±–æ—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã URL:</p>
                    <p>?username=–∏–º—è&city=–≥–æ—Ä–æ–¥</p>
                    <p>–ù–∞–ø—Ä–∏–º–µ—Ä: ?username=aliaskhan&city=Kokshetau</p>
                </div>
            `;
        } else {
            // –î–∞–Ω–Ω—ã–µ
            const data = {
                city: userCity,
                date: new Date().toLocaleDateString('ru-RU'),
                time: new Date().toLocaleTimeString('ru-RU'),
                weather: "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞..."
            };

            // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
            function saveToCache(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:', e);
                }
            }

            function getFromCache(key) {
                try {
                    const value = localStorage.getItem(key);
                    return value ? JSON.parse(value) : null;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∫—ç—à–∞:', e);
                    return null;
                }
            }

            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–≥–æ–¥–Ω–æ–π –∏–∫–æ–Ω–∫–∏
            function getWeatherEmoji(condition) {
                if (!condition) return '';
                
                condition = condition.toLowerCase();
                
                if (condition.includes('—è—Å–Ω–æ') || condition.includes('—Å–æ–ª–Ω–µ—á–Ω–æ') || 
                    condition.includes('clear') || condition.includes('sunny')) return '‚òÄÔ∏è ';
                if ((condition.includes('–æ–±–ª–∞—á–Ω–æ') || condition.includes('cloudy')) && 
                    (condition.includes('–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è') || condition.includes('partly'))) return 'üå§Ô∏è ';
                if (condition.includes('–æ–±–ª–∞—á–Ω–æ') || condition.includes('cloudy') || 
                    condition.includes('overcast')) return '‚òÅÔ∏è ';
                if ((condition.includes('–¥–æ–∂–¥—å') || condition.includes('rain')) && 
                    (condition.includes('–≥—Ä–æ–∑–∞') || condition.includes('thunder'))) return '‚õàÔ∏è ';
                if (condition.includes('–¥–æ–∂–¥—å') || condition.includes('rain')) return 'üåßÔ∏è ';
                if (condition.includes('—Å–Ω–µ–≥') || condition.includes('snow')) return '‚ùÑÔ∏è ';
                if (condition.includes('—Ç—É–º–∞–Ω') || condition.includes('fog') || 
                    condition.includes('mist')) return 'üå´Ô∏è ';
                if (condition.includes('–≥—Ä–æ–∑–∞') || condition.includes('thunder') || 
                    condition.includes('lightning')) return 'üå©Ô∏è ';
                
                return '';
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –¥–ª—è API
            function getCorrectCityName(city) {
                const lowerCity = city.toLowerCase();
                return cityMapping[lowerCity] || city;
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã
            async function fetchWeather() {
                try {
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
                    const cacheKey = `weather_${userCity}`;
                    const cachedData = getFromCache(cacheKey);
                    const now = new Date().getTime();
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å—Ç–∞—Ä—à–µ 30 –º–∏–Ω—É—Ç
                    if (cachedData && (now - cachedData.timestamp < 30 * 60 * 1000)) {
                        data.weather = cachedData.data;
                        renderJSON();
                        return;
                    }
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
                    const correctCityName = getCorrectCityName(userCity);
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º wttr.in –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
                    const response = await fetch(`https://wttr.in/${encodeURIComponent(correctCityName)}?format=j1`);
                    
                    if (!response.ok) {
                        throw new Error(`–û—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);
                    }
                    
                    const weatherData = await response.json();
                    
                    // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö
                    const current = weatherData.current_condition[0];
                    
                    // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ–≥–æ–¥—ã
                    const weatherDesc = current.weatherDesc[0].value;
                    const emoji = getWeatherEmoji(weatherDesc);
                    const weatherString = `${emoji}${weatherDesc}, ${current.temp_C}¬∞C`;
                    
                    data.weather = weatherString;
                    
                    // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                    saveToCache(cacheKey, {
                        timestamp: now,
                        data: weatherString
                    });
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã:', error);
                    
                    // –°–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ö–æ–∫—à–µ—Ç–∞—É
                    const now = new Date();
                    const month = now.getMonth();
                    
                    let weatherCondition, temperature;
                    
                    // –ü—Ä–∏–º–µ—Ä–Ω—ã–µ –ø–æ–≥–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —Å–µ–∑–æ–Ω–∞–º –¥–ª—è –ö–æ–∫—à–µ—Ç–∞—É
                    if (month >= 11 || month <= 1) {  // –ó–∏–º–∞ (–¥–µ–∫–∞–±—Ä—å-—Ñ–µ–≤—Ä–∞–ª—å)
                        weatherCondition = "–°–Ω–µ–≥";
                        temperature = Math.floor(Math.random() * 10) - 15;  // –æ—Ç -15 –¥–æ -5
                    } else if (month >= 2 && month <= 4) {  // –í–µ—Å–Ω–∞ (–º–∞—Ä—Ç-–º–∞–π)
                        weatherCondition = ["–Ø—Å–Ω–æ", "–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å", "–î–æ–∂–¥—å"][Math.floor(Math.random() * 3)];
                        temperature = Math.floor(Math.random() * 15);  // –æ—Ç 0 –¥–æ 15
                    } else if (month >= 5 && month <= 8) {  // –õ–µ—Ç–æ (–∏—é–Ω—å-—Å–µ–Ω—Ç—è–±—Ä—å)
                        weatherCondition = ["–Ø—Å–Ω–æ", "–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å", "–ì—Ä–æ–∑–∞"][Math.floor(Math.random() * 3)];
                        temperature = Math.floor(Math.random() * 15) + 15;  // –æ—Ç 15 –¥–æ 30
                    } else {  // –û—Å–µ–Ω—å (–æ–∫—Ç—è–±—Ä—å-–Ω–æ—è–±—Ä—å)
                        weatherCondition = ["–ü–∞—Å–º—É—Ä–Ω–æ", "–î–æ–∂–¥—å", "–Ø—Å–Ω–æ"][Math.floor(Math.random() * 3)];
                        temperature = Math.floor(Math.random() * 15);  // –æ—Ç 0 –¥–æ 15
                    }
                    
                    const emoji = getWeatherEmoji(weatherCondition);
                    data.weather = `${emoji}${weatherCondition}, ${temperature}¬∞C`;
                } finally {
                    renderJSON();
                }
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
            function updateTime() {
                data.time = new Date().toLocaleTimeString('ru-RU');
                renderJSON();
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSON —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
            function formatJSON(obj) {
                const json = JSON.stringify(obj, null, 4);
                
                return json
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                        let cls = 'json-number';
                        if (/^"/.test(match)) {
                            if (/:$/.test(match)) {
                                cls = 'json-key';
                                match = match.replace(/"(.*)":/g, '"$1"<span class="json-colon">:</span>');
                            } else {
                                cls = 'json-string';
                                
                                // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏
                                if (match.includes(data.time)) {
                                    match = match.replace(`"${data.time}"`, `"<span class="time-container">${data.time}</span>"`);
                                }
                            }
                        }
                        return '<span class="' + cls + '">' + match + '</span>';
                    })
                    .replace(/\{|\}/g, match => `<span class="json-bracket">${match}</span>`)
                    .replace(/\[|\]/g, match => `<span class="json-bracket">${match}</span>`)
                    .replace(/,/g, '<span class="json-comma">,</span>');
            }

            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ JSON —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            function renderJSON() {
                const jsonData = {
                    [userName]: {
                        date: data.date,
                        time: data.time,
                        weather: data.weather,
                        city: data.city
                    }
                };
                
                document.getElementById('json-content').innerHTML = formatJSON(jsonData);
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            function init() {
                setInterval(updateTime, 1000);
                fetchWeather();
                setInterval(fetchWeather, 30 * 60 * 1000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
                renderJSON();
            }

            init();
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ–º–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å JSON –¥–∞–Ω–Ω—ã–º–∏</title>
    <style>
        body {
            background: #0f1119;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: monospace;
            color: #e0e0e0;
            overflow: hidden;
        }
        
        .glass-container {
            width: 450px;
            background: rgba(30, 34, 51, 0.4);
            border-radius: 15px;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
            padding: 25px;
        }
        
        .json-display {
            width: 100%;
            line-height: 1.6;
            font-size: 16px;
            margin: 0;
            white-space: pre-wrap;
            color: #bdc7d8;
            overflow: hidden;
        }
        
        .json-key { color: #73c990; }
        .json-string { color: #ff98a4; }
        .json-bracket { color: #c39ac9; }
        .json-colon { color: #79b8ff; margin-right: 8px; }
        .json-comma { color: #79b8ff; }
        
        .time-container {
            display: inline-block;
            padding: 2px 4px;
            background: rgba(121, 184, 255, 0.1);
            border-radius: 4px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { background: rgba(121, 184, 255, 0.1); }
            50% { background: rgba(121, 184, 255, 0.2); }
        }
        
        .shape {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, #5151cf, #2d348e);
            opacity: 0.15;
            z-index: -1;
        }
        
        .shape:nth-child(1) {
            width: 300px;
            height: 300px;
            top: 20%;
            left: 25%;
            animation: float 15s infinite;
        }
        
        .shape:nth-child(2) {
            width: 250px;
            height: 250px;
            bottom: 15%;
            right: 30%;
            animation: float 20s infinite reverse;
        }

        .no-params {
            text-align: center;
            font-size: 18px;
            color: #ff98a4;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-10px, 15px) rotate(5deg); }
        }
    </style>
</head>
<body>
    <div class="shape"></div>
    <div class="shape"></div>
    
    <div class="glass-container" id="container">
        <pre id="json-content" class="json-display"></pre>
    </div>

    <script>
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const userName = urlParams.get('username');
        const userCity = urlParams.get('city');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        if (!userName || !userCity) {
            document.getElementById('container').innerHTML = `
                <div class="no-params">
                    <p>–î–ª—è —Ä–∞–±–æ—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã URL:</p>
                    <p>?username=–∏–º—è&city=–≥–æ—Ä–æ–¥</p>
                    <p>–ù–∞–ø—Ä–∏–º–µ—Ä: ?username=aliaskhan&city=Kokshetay</p>
                </div>
            `;
        } else {
            // –î–∞–Ω–Ω—ã–µ
            const data = {
                city: userCity,
                date: new Date().toLocaleDateString('ru-RU'),
                time: new Date().toLocaleTimeString('ru-RU'),
                weather: "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞..."
            };

            // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
            function saveToCache(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:', e);
                }
            }

            function getFromCache(key) {
                try {
                    const value = localStorage.getItem(key);
                    return value ? JSON.parse(value) : null;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∫—ç—à–∞:', e);
                    return null;
                }
            }

            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–≥–æ–¥–Ω–æ–π –∏–∫–æ–Ω–∫–∏
            function getWeatherEmoji(condition) {
                if (!condition) return '';
                
                condition = condition.toLowerCase();
                
                if (condition.includes('—è—Å–Ω–æ') || condition.includes('—Å–æ–ª–Ω–µ—á–Ω–æ')) return '‚òÄÔ∏è ';
                if (condition.includes('–æ–±–ª–∞—á–Ω–æ') && condition.includes('–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è')) return 'üå§Ô∏è ';
                if (condition.includes('–æ–±–ª–∞—á–Ω–æ')) return '‚òÅÔ∏è ';
                if (condition.includes('–¥–æ–∂–¥—å') && condition.includes('–≥—Ä–æ–∑–∞')) return '‚õàÔ∏è ';
                if (condition.includes('–¥–æ–∂–¥—å')) return 'üåßÔ∏è ';
                if (condition.includes('—Å–Ω–µ–≥')) return '‚ùÑÔ∏è ';
                if (condition.includes('—Ç—É–º–∞–Ω')) return 'üå´Ô∏è ';
                if (condition.includes('–≥—Ä–æ–∑–∞')) return 'üå©Ô∏è ';
                
                return '';
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã
            async function fetchWeather() {
                try {
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
                    const cacheKey = `weather_${userCity}`;
                    const cachedData = getFromCache(cacheKey);
                    const now = new Date().getTime();
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å—Ç–∞—Ä—à–µ 30 –º–∏–Ω—É—Ç
                    if (cachedData && (now - cachedData.timestamp < 30 * 60 * 1000)) {
                        data.weatherData = cachedData.data;
                        renderJSON();
                        return;
                    }
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º wttr.in –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                    const response = await fetch(`https://wttr.in/${encodeURIComponent(userCity)}?format=j1`);
                    
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö');
                    }
                    
                    const weatherData = await response.json();
                    
                    // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö
                    const current = weatherData.current_condition[0];
                    const forecast = weatherData.weather[0];
                    
                    // –î–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ
                    const weatherInfo = {
                        status: current.weatherDesc[0].value,
                        temperature: `${current.temp_C}¬∞C`,
                        feels_like: `${current.FeelsLikeC}¬∞C`,
                        humidity: `${current.humidity}%`,
                        wind: `${current.windspeedKmph} –∫–º/—á, ${current.winddir16Point}`,
                        pressure: `${current.pressure} –º–±–∞—Ä`,
                        visibility: `${current.visibility} –∫–º`,
                        uv_index: current.uvIndex,
                        cloudcover: `${current.cloudcover}%`,
                        observation_time: current.observation_time,
                        forecast: {
                            max_temp: `${forecast.maxtempC}¬∞C`,
                            min_temp: `${forecast.mintempC}¬∞C`,
                            sunrise: forecast.astronomy[0].sunrise,
                            sunset: forecast.astronomy[0].sunset,
                            moon_phase: forecast.astronomy[0].moon_phase
                        }
                    };
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    data.weatherData = weatherInfo;
                    
                    // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    const emoji = getWeatherEmoji(weatherInfo.status);
                    data.weather = `${emoji}${weatherInfo.status}, ${weatherInfo.temperature}`;
                    
                    // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                    saveToCache(cacheKey, {
                        timestamp: now,
                        data: weatherInfo
                    });
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã:', error);
                    
                    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    const conditions = [
                        { text: "—è—Å–Ω–æ", emoji: "‚òÄÔ∏è" },
                        { text: "–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å", emoji: "üå§Ô∏è" },
                        { text: "–æ–±–ª–∞—á–Ω–æ", emoji: "‚òÅÔ∏è" },
                        { text: "–¥–æ–∂–¥—å", emoji: "üåßÔ∏è" },
                        { text: "—Å–Ω–µ–≥", emoji: "‚ùÑÔ∏è" }
                    ];
                    
                    const randomCondition = conditions[Math.floor(Math.random() * conditions.length)];
                    const randomTemp = Math.floor(Math.random() * 35 - 10);
                    
                    data.weather = `${randomCondition.emoji} ${randomCondition.text}, ${randomTemp}¬∞C`;
                    
                    // –°–æ–∑–¥–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –ø–æ–≥–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    data.weatherData = {
                        status: randomCondition.text,
                        temperature: `${randomTemp}¬∞C`,
                        feels_like: `${randomTemp - Math.floor(Math.random() * 5)}¬∞C`,
                        humidity: `${Math.floor(Math.random() * 100)}%`,
                        wind: `${Math.floor(Math.random() * 20)} –∫–º/—á`,
                        pressure: `${Math.floor(Math.random() * 100) + 950} –º–±–∞—Ä`,
                        visibility: `${Math.floor(Math.random() * 10) + 1} –∫–º`,
                        uv_index: Math.floor(Math.random() * 11),
                        cloudcover: `${Math.floor(Math.random() * 100)}%`,
                        note: "–î–∞–Ω–Ω—ã–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏"
                    };
                } finally {
                    renderJSON();
                }
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
            function updateTime() {
                data.time = new Date().toLocaleTimeString('ru-RU');
                renderJSON();
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSON —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
            function formatJSON(obj) {
                const json = JSON.stringify(obj, null, 4);
                
                return json
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                        let cls = 'json-number';
                        if (/^"/.test(match)) {
                            if (/:$/.test(match)) {
                                cls = 'json-key';
                                match = match.replace(/"(.*)":/g, '"$1"<span class="json-colon">:</span>');
                            } else {
                                cls = 'json-string';
                                
                                // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏
                                if (match.includes(data.time)) {
                                    match = match.replace(`"${data.time}"`, `"<span class="time-container">${data.time}</span>"`);
                                }
                            }
                        }
                        return '<span class="' + cls + '">' + match + '</span>';
                    })
                    .replace(/\{|\}/g, match => `<span class="json-bracket">${match}</span>`)
                    .replace(/\[|\]/g, match => `<span class="json-bracket">${match}</span>`)
                    .replace(/,/g, '<span class="json-comma">,</span>');
            }

            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ JSON
            function renderJSON() {
                const jsonData = {
                    [userName]: {
                        date: data.date,
                        time: data.time,
                        weather: data.weather,
                        city: data.city,
                        –¥–µ—Ç–∞–ª–∏: data.weatherData || "–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."
                    }
                };
                
                document.getElementById('json-content').innerHTML = formatJSON(jsonData);
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            function init() {
                setInterval(updateTime, 1000);
                fetchWeather();
                setInterval(fetchWeather, 30 * 60 * 1000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
                renderJSON();
            }

            init();
        }
    </script>
</body>
</html>
